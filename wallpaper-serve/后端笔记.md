## 壁纸分享馆后端笔记

### 数据库设计

```
1 壁纸表 (wallpaper)
	ID、标题、描述、图片地址、类型（0普通、1专辑）、分类ID、状态（0待审核、1已通过、2未通过）、推荐（0否，1是）、上传用户ID、用户名、用户头像、创建时间
2 分类表 (category)
	ID、分类名称、封面、类型（0分类、1专辑）、排序值、状态（0禁用、1启用）、创建时间、更新时间
3 
```

### 创建数据表

```
1 壁纸表 (wallpaper)
    create table if not exists wallpaper(
        id VARCHAR(100) NOT NULL,
        title VARCHAR(100) NOT NULL COMMENT '壁纸标题',
        description VARCHAR(2000) DEFAULT NULL COMMENT '壁纸描述',
        url VARCHAR(100) NOT NULL COMMENT '图片地址',
        category_id VARCHAR(100) NOT NULL COMMENT '分类ID',
        type INT DEFAULT 0 COMMENT '类型 0-普通 1-专辑',
        status INT DEFAULT 0 COMMENT '状态 0-待审核 1-已通过 2-未通过',
        recommend INT DEFAULT 0 COMMENT '是否推荐 0-否 1-是',
        user_id VARCHAR(100) NOT NULL COMMENT '上传用户ID',
        user_name VARCHAR(100) NOT NULL COMMENT '用户名',
        user_avatar VARCHAR(255) DEFAULT NULL COMMENT '用户头像',
        createdate VARCHAR(100) NOT NULL COMMENT '创建时间',
        PRIMARY KEY (id)
    );
2 分类表 (category)
    create table if not exists category(
        id VARCHAR(100) NOT NULL,
        name VARCHAR(100) NOT NULL COMMENT '分类名称',
        cover VARCHAR(100) NOT NULL COMMENT '封面',
        type INT DEFAULT 0 COMMENT '类型 0-分类 1-专辑',
        sort INT DEFAULT 10 COMMENT '排序值',
        status INT DEFAULT 1 COMMENT '状态 0-禁用 1-启用',
        createdate VARCHAR(100) NOT NULL COMMENT '创建时间',
        updatedate VARCHAR(100) NOT NULL COMMENT 'gen'x时间',
        PRIMARY KEY (id)
    );
```

```
-- 壁纸表
CREATE TABLE `wallpaper` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `title` VARCHAR(100) NOT NULL COMMENT '壁纸标题',
  `description` VARCHAR(255) DEFAULT NULL COMMENT '壁纸描述',
  `category_id` INT NOT NULL COMMENT '分类ID',
  `user_id` INT DEFAULT NULL COMMENT '上传用户ID，NULL表示系统上传',
  `image_url` VARCHAR(255) NOT NULL COMMENT '图片地址',
  `thumbnail_url` VARCHAR(255) DEFAULT NULL COMMENT '缩略图地址',
  `width` INT DEFAULT 0 COMMENT '图片宽度',
  `height` INT DEFAULT 0 COMMENT '图片高度',
  `size` INT DEFAULT 0 COMMENT '图片大小(KB)',
  `format` VARCHAR(20) DEFAULT NULL COMMENT '图片格式(jpg/png/gif等)',
  `is_dynamic` TINYINT DEFAULT 0 COMMENT '是否动态壁纸 0-否 1-是',
  `download_count` INT DEFAULT 0 COMMENT '下载次数',
  `view_count` INT DEFAULT 0 COMMENT '浏览次数',
  `favor_count` INT DEFAULT 0 COMMENT '收藏次数',
  `is_hot` TINYINT DEFAULT 0 COMMENT '是否热门 0-否 1-是',
  `is_recommend` TINYINT DEFAULT 0 COMMENT '是否推荐 0-否 1-是',
  `status` TINYINT DEFAULT 1 COMMENT '状态 0-待审核 1-已通过 2-已拒绝',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (`category_id`) REFERENCES `category`(`id`),
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`)
);
-- 用户表
CREATE TABLE `user` (
  `id` VARCHAR(100) PRIMARY KEY ,
  `wx_id` VARCHAR(100) UNIQUE NOT NULL COMMENT '微信唯一标识',
  `name` VARCHAR(50) DEFAULT NULL COMMENT '用户昵称',
  `avatar_url` VARCHAR(255) DEFAULT NULL COMMENT '头像地址',
  `gender` INT DEFAULT 0 COMMENT '性别 0-未知 1-男 2-女',
  `motto` VARCHAR(255) DEFAULT NULL COMMENT '格言',
  `createdate` VARCHAR(100) NOT NULL COMMENT '创建时间'
);
-- 用户关注表
CREATE TABLE `user_follow` (
  `id` INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增主键',
  `user_id` INT NOT NULL COMMENT '当前用户ID（关注者）',
  `follow_user_id` INT NOT NULL COMMENT '被关注用户ID',
  `status` TINYINT DEFAULT 1 COMMENT '关注状态：1-正常关注，0-已取消关注（逻辑删除）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '关注时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '状态更新时间',
  -- 关联用户表外键
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`follow_user_id`) REFERENCES `user`(`id`) ON DELETE CASCADE,
  -- 唯一索引：避免同一用户重复关注同一对象
  UNIQUE KEY `uk_user_follow` (`user_id`, `follow_user_id`)
);
-- 壁纸分类表
CREATE TABLE `category` (
  `id` VARCHAR(100)  PRIMARY KEY ,
  `name` VARCHAR(50) NOT NULL COMMENT '分类名称',
  `parent_id` INT DEFAULT 0 COMMENT '父分类ID，0表示顶级分类',
  `sort` INT DEFAULT 0 COMMENT '排序值',
  `status` TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 标签表
CREATE TABLE `tag` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `name` VARCHAR(50) NOT NULL COMMENT '标签名称',
  `count` INT DEFAULT 0 COMMENT '使用次数',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 壁纸标签关联表
CREATE TABLE `wallpaper_tag` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `wallpaper_id` INT NOT NULL COMMENT '壁纸ID',
  `tag_id` INT NOT NULL COMMENT '标签ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`wallpaper_id`) REFERENCES `wallpaper`(`id`),
  FOREIGN KEY (`tag_id`) REFERENCES `tag`(`id`)
);

-- 用户收藏表
CREATE TABLE `user_favorite` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` INT NOT NULL COMMENT '用户ID',
  `wallpaper_id` INT NOT NULL COMMENT '壁纸ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`),
  FOREIGN KEY (`wallpaper_id`) REFERENCES `wallpaper`(`id`),
  UNIQUE KEY `uk_user_wallpaper` (`user_id`, `wallpaper_id`)
);

-- 用户下载记录表
CREATE TABLE `user_download` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` INT NOT NULL COMMENT '用户ID',
  `wallpaper_id` INT NOT NULL COMMENT '壁纸ID',
  `device` VARCHAR(50) DEFAULT NULL COMMENT '下载设备',
  `system` VARCHAR(50) DEFAULT NULL COMMENT '操作系统',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`),
  FOREIGN KEY (`wallpaper_id`) REFERENCES `wallpaper`(`id`)
);

-- 用户评论表
CREATE TABLE `user_comment` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` INT NOT NULL COMMENT '用户ID',
  `wallpaper_id` INT NOT NULL COMMENT '壁纸ID',
  `content` TEXT NOT NULL COMMENT '评论内容',
  `parent_id` INT DEFAULT 0 COMMENT '父评论ID，0表示主评论',
  `status` TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`),
  FOREIGN KEY (`wallpaper_id`) REFERENCES `wallpaper`(`id`)
);

-- 轮播图表
CREATE TABLE `banner` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `title` VARCHAR(100) DEFAULT NULL COMMENT '标题',
  `image_url` VARCHAR(255) NOT NULL COMMENT '图片地址',
  `link_type` TINYINT DEFAULT 0 COMMENT '链接类型 0-无链接 1-壁纸详情 2-分类列表 3-外部链接',
  `link_value` VARCHAR(255) DEFAULT NULL COMMENT '链接值(根据link_type不同而不同)',
  `sort` INT DEFAULT 0 COMMENT '排序值',
  `status` TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-启用',
  `start_time` DATETIME DEFAULT NULL COMMENT '开始时间',
  `end_time` DATETIME DEFAULT NULL COMMENT '结束时间',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 积分记录表
CREATE TABLE `points_log` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `user_id` INT NOT NULL COMMENT '用户ID',
  `points` INT NOT NULL COMMENT '积分变动值(正为增加，负为减少)',
  `type` TINYINT NOT NULL COMMENT '积分类型 1-每日登录 2-下载壁纸 3-分享小程序 4-兑换物品 5-管理员操作',
  `remark` VARCHAR(255) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`)
);

-- 广告位表
CREATE TABLE `advert` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `position` VARCHAR(50) NOT NULL COMMENT '广告位置标识',
  `name` VARCHAR(100) DEFAULT NULL COMMENT '广告名称',
  `image_url` VARCHAR(255) DEFAULT NULL COMMENT '广告图片地址',
  `link_url` VARCHAR(255) DEFAULT NULL COMMENT '广告链接',
  `sort` INT DEFAULT 0 COMMENT '排序值',
  `status` TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-启用',
  `start_time` DATETIME DEFAULT NULL COMMENT '开始时间',
  `end_time` DATETIME DEFAULT NULL COMMENT '结束时间',
  `click_count` INT DEFAULT 0 COMMENT '点击次数',
  `show_count` INT DEFAULT 0 COMMENT '展示次数',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP
);    
```

